<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üçÑ ShroomsBloomIdle üçÑ</title>
    
    <meta name="google-site-verification" content="WD9jU3PUtJ62afpsYdCQ49OY-DFohBKMit9Fq4ur9kY" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçÑ</text></svg>">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0a0118">

    <style>
        :root { --neon: #ff00ff; --cyan: #00ffff; --gold: #ffd700; --bg: #0a0118; --xp-color: #39ff14; }
        body { margin: 0; font-family: sans-serif; background: var(--bg); color: #fff; text-align: center; overflow-x: hidden; }
        #topBar { padding: 15px; background: rgba(0,0,0,0.8); border-bottom: 2px solid var(--neon); }
        
        /* Level & XP Bar Styles */
        .xp-container { width: 80%; max-width: 400px; height: 12px; background: #222; border-radius: 10px; margin: 10px auto; border: 1px solid #444; overflow: hidden; }
        #xpFill { height: 100%; width: 0%; background: var(--xp-color); box-shadow: 0 0 10px var(--xp-color); transition: width 0.3s; }
        .lvl-text { font-weight: bold; color: var(--xp-color); font-size: 0.9em; }

        .spore-display { font-size: 3em; color: var(--gold); margin: 10px 0; font-weight: bold; }
        #mushroomClicker { font-size: 110px; cursor: pointer; display: inline-block; transition: transform 0.1s; user-select: none; margin: 10px; }
        #mushroomClicker:active { transform: scale(0.9); }
        
        .upgrade-card { background: rgba(255,255,255,0.05); margin: 8px auto; padding: 12px; max-width: 400px; border-radius: 10px; border: 1px solid rgba(0,255,255,0.3); display: flex; justify-content: space-between; align-items: center; }
        button { background: var(--cyan); color: #000; border: none; padding: 10px 15px; border-radius: 5px; font-weight: bold; cursor: pointer; }
        button:disabled { opacity: 0.3; cursor: not-allowed; }
        
        #installBtn { display: none; background: var(--neon); color: white; margin: 15px auto; padding: 12px 25px; border-radius: 8px; font-weight: bold; border: none; animation: glow 2s infinite; }
        @keyframes glow { 0% { box-shadow: 0 0 5px var(--neon); } 50% { box-shadow: 0 0 20px var(--neon); } 100% { box-shadow: 0 0 5px var(--neon); } }
    </style>
</head>
<body onload="initGame()">

<div id="topBar">
    <h2 style="margin:0; color:var(--neon);">SHROOMS BLOOM</h2>
    <div class="lvl-text">Level <span id="playerLvl">1</span></div>
    <div class="xp-container"><div id="xpFill"></div></div>
</div>

<button id="installBtn" onclick="installApp()">üì≤ INSTALL APP</button>

<div class="spore-display"><span id="spores">0</span></div>
<div style="font-size: 0.8em; opacity: 0.7;">Spores Per Sec: <span id="rate">0</span></div>

<div id="mushroomClicker">üçÑ</div>

<div id="upgradeContainer"></div>

<script>
    let spores = 0;
    let level = 1;
    let xp = 0;
    let deferredPrompt;
    
    let upgrades = [
        { id: 0, name: "Spore Collector", cost: 15, rate: 1, qty: 0 },
        { id: 1, name: "Fungal Patch", cost: 100, rate: 8, qty: 0 },
        { id: 2, name: "Ancient Grove", cost: 1000, rate: 45, qty: 0 }
    ];

    function getXpNeeded() { return Math.floor(100 * Math.pow(1.3, level - 1)); }

    function initGame() {
        loadGame();
        renderUpgrades();
        setInterval(gameLoop, 100);
        setInterval(saveGame, 10000); // Auto-save every 10 seconds
    }

    function addXP(amount) {
        xp += amount;
        let needed = getXpNeeded();
        while (xp >= needed) {
            xp -= needed;
            level++;
            needed = getXpNeeded();
            // Optional: Alert or effect for leveling up could go here
        }
        updateUI();
    }

    document.getElementById('mushroomClicker').onclick = () => {
        spores += 1;
        addXP(2); // Clicking gives 2 XP
        updateUI();
    };

    function renderUpgrades() {
        const container = document.getElementById('upgradeContainer');
        container.innerHTML = '';
        upgrades.forEach(u => {
            container.innerHTML += `
                <div class="upgrade-card">
                    <div style="text-align:left">
                        <strong>${u.name}</strong><br>
                        <small>Qty: ${u.qty} (+${u.rate}/s)</small>
                    </div>
                    <button id="btn-${u.id}" onclick="buyUpgrade(${u.id})">Buy: ${u.cost}</button>
                </div>
            `;
        });
    }

    function buyUpgrade(id) {
        if (spores >= upgrades[id].cost) {
            spores -= upgrades[id].cost;
            upgrades[id].qty++;
            upgrades[id].cost = Math.floor(upgrades[id].cost * 1.15);
            renderUpgrades();
            updateUI();
        }
    }

    function gameLoop() {
        let sps = 0;
        upgrades.forEach(u => sps += (u.qty * u.rate));
        let frameGain = (sps / 10);
        spores += frameGain;
        if (sps > 0) addXP(frameGain * 0.5); // Passive XP gain (half speed of clicks)
        
        document.getElementById('rate').textContent = sps.toFixed(1);
        updateUI();
    }

    function updateUI() {
        document.getElementById('spores').textContent = Math.floor(spores).toLocaleString();
        document.getElementById('playerLvl').textContent = level;
        
        let pct = (xp / getXpNeeded()) * 100;
        document.getElementById('xpFill').style.width = pct + "%";

        upgrades.forEach(u => {
            const btn = document.getElementById(`btn-${u.id}`);
            if (btn) btn.disabled = (spores < u.cost);
        });
    }

    function saveGame() {
        const data = { spores, level, xp, upgrades };
        localStorage.setItem('shroomSave_v2', JSON.stringify(data));
    }

    function loadGame() {
        const saved = localStorage.getItem('shroomSave_v2');
        if (saved) {
            const data = JSON.parse(saved);
            spores = data.spores || 0;
            level = data.level || 1;
            xp = data.xp || 0;
            if (data.upgrades) upgrades = data.upgrades;
        }
    }

    // PWA Setup
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        document.getElementById('installBtn').style.display = 'block';
    });

    async function installApp() {
        if (deferredPrompt) {
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            if (outcome === 'accepted') document.getElementById('installBtn').style.display = 'none';
            deferredPrompt = null;
        }
    }
</script>
</body>
</html>
